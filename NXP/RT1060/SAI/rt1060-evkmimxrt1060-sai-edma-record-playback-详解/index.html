<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>RT1060 evkmimxrt1060_sai_edma_record_playback 详解 - DustOfStars</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#f7f7f7"><meta name="application-name" content="DustOfStars"><meta name="msapplication-TileImage" content="/img/favicon.png"><meta name="msapplication-TileColor" content="#f7f7f7"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="DustOfStars"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="evkmimxrt1060_sai_edma_record_playback 详细解析 evkmimxrt1060_sai_edma_record_playback  硬件：RT1060-EVK IDE：MCUXpresso SDK：2.16.000"><meta property="og:type" content="blog"><meta property="og:title" content="RT1060 evkmimxrt1060_sai_edma_record_playback 详解"><meta property="og:url" content="https://dustofstars.github.io/NXP/RT1060/SAI/rt1060-evkmimxrt1060-sai-edma-record-playback-%E8%AF%A6%E8%A7%A3/"><meta property="og:site_name" content="DustOfStars"><meta property="og:description" content="evkmimxrt1060_sai_edma_record_playback 详细解析 evkmimxrt1060_sai_edma_record_playback  硬件：RT1060-EVK IDE：MCUXpresso SDK：2.16.000"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://dustofstars.github.io/gallery/covers/RT1060_SAI_edma.png"><meta property="article:published_time" content="2025-05-28T14:32:01.000Z"><meta property="article:modified_time" content="2025-05-28T14:32:01.000Z"><meta property="article:author" content="Gavin"><meta property="article:tag" content="NXP"><meta property="article:tag" content="SAI"><meta property="article:tag" content="eDMA"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://dustofstars.github.io/gallery/covers/RT1060_SAI_edma.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://dustofstars.github.io/NXP/RT1060/SAI/rt1060-evkmimxrt1060-sai-edma-record-playback-%E8%AF%A6%E8%A7%A3/"},"headline":"RT1060 evkmimxrt1060_sai_edma_record_playback 详解","image":["https://dustofstars.github.io/gallery/covers/RT1060_SAI_edma.png"],"datePublished":"2025-05-28T14:32:01.000Z","dateModified":"2025-05-28T14:32:01.000Z","author":{"@type":"Person","name":"Gavin"},"publisher":{"@type":"Organization","name":"DustOfStars","logo":{"@type":"ImageObject","url":"https://dustofstars.github.io/img/logo.png"}},"description":"evkmimxrt1060_sai_edma_record_playback 详细解析 evkmimxrt1060_sai_edma_record_playback  硬件：RT1060-EVK IDE：MCUXpresso SDK：2.16.000"}</script><link rel="canonical" href="https://dustofstars.github.io/NXP/RT1060/SAI/rt1060-evkmimxrt1060-sai-edma-record-playback-%E8%AF%A6%E8%A7%A3/"><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-72437521-5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-72437521-5');</script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0">
<style>.not-gallery-item { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .not-gallery-item > span { position: relative; z-index: 10; }  .not-gallery-item img, .not-gallery-item .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .not-gallery-item img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .not-gallery-item-fallback { color: inherit; } .not-gallery-item-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="DustOfStars" type="application/atom+xml">
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="DustOfStars" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Discuss on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus/discussions"><i class="fas fa-comments"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/gallery/covers/RT1060_SAI_edma.png" alt="RT1060 evkmimxrt1060_sai_edma_record_playback 详解"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-05-28T14:32:01.000Z" title="5/28/2025, 2:32:01 PM">2025-05-28</time>发表</span><span class="level-item"><a class="link-muted" href="/categories/NXP/">NXP</a><span> / </span><a class="link-muted" href="/categories/NXP/RT1060/">RT1060</a><span> / </span><a class="link-muted" href="/categories/NXP/RT1060/SAI/">SAI</a></span><span class="level-item">1 小时读完 (大约6790个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">RT1060 evkmimxrt1060_sai_edma_record_playback 详解</h1><div class="content"><h1 id="evkmimxrt1060-sai-edma-record-playback"><a href="#evkmimxrt1060-sai-edma-record-playback" class="headerlink" title="evkmimxrt1060_sai_edma_record_playback"></a>evkmimxrt1060_sai_edma_record_playback</h1><blockquote>
<p>详细解析 evkmimxrt1060_sai_edma_record_playback</p>
<ul>
<li>硬件：RT1060-EVK</li>
<li>IDE：MCUXpresso</li>
<li>SDK：2.16.000</li>
</ul>
</blockquote>
<span id="more"></span>

<h2 id="0-工程用到的外设拆解"><a href="#0-工程用到的外设拆解" class="headerlink" title="0. 工程用到的外设拆解"></a>0. 工程用到的外设拆解</h2><style>.bbtefbnbovtb{zoom:100%;}</style><img src="/NXP/RT1060/SAI/rt1060-evkmimxrt1060-sai-edma-record-playback-%E8%AF%A6%E8%A7%A3/image-20250528224056154.png" class="bbtefbnbovtb" alt="image-20250528224056154">

<ol>
<li>UART</li>
<li>I2C</li>
<li>SAI: 在这个例子中，SAI是master，会向codec输出MCLK。</li>
<li>Codec:</li>
<li>DMAMUX</li>
<li>eDMA</li>
</ol>
<h2 id="1-main函数主逻辑"><a href="#1-main函数主逻辑" class="headerlink" title="1. main函数主逻辑"></a>1. main函数主逻辑</h2><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">sai_transfer_t</span> xfer; <span class="comment">// 用于定义一次SAI传输的数据缓冲区和大小</span></span><br><span class="line">    <span class="type">sai_transceiver_t</span> saiConfig; <span class="comment">// 用于配置SAI收发器，比如工作模式、数据格式等</span></span><br><span class="line"></span><br><span class="line">    BOARD_ConfigMPU(); <span class="comment">// 配置内存保护单元 (MPU)，通常用于设置内存区域的访问权限等，保证系统稳定性</span></span><br><span class="line">    BOARD_InitBootPins(); <span class="comment">// 初始化开发板的引脚，将特定引脚配置为SAI、I2C、UART等外设的功能</span></span><br><span class="line">    BOARD_InitBootClocks(); <span class="comment">// 初始化系统时钟，包括CPU核心时钟、外设时钟等</span></span><br><span class="line">    CLOCK_InitAudioPll(&amp;audioPllConfig); <span class="comment">// 初始化音频PLL (锁相环)，这个PLL通常用来为SAI提供高精度的音频主时钟</span></span><br><span class="line">    BOARD_InitDebugConsole(); <span class="comment">// 初始化调试控制台，通常是配置UART，用于通过串口打印信息（比如 "SAI example started!"）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*Clock setting for LPI2C*/</span></span><br><span class="line">    CLOCK_SetMux(kCLOCK_Lpi2cMux, DEMO_LPI2C_CLOCK_SOURCE_SELECT); <span class="comment">// 选择LPI2C的时钟源</span></span><br><span class="line">    CLOCK_SetDiv(kCLOCK_Lpi2cDiv, DEMO_LPI2C_CLOCK_SOURCE_DIVIDER); <span class="comment">// 设置LPI2C时钟的分频器，确定其工作频率</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*Clock setting for SAI1*/</span></span><br><span class="line">    CLOCK_SetMux(kCLOCK_Sai1Mux, DEMO_SAI1_CLOCK_SOURCE_SELECT); <span class="comment">// 选择SAI1的时钟源</span></span><br><span class="line">    CLOCK_SetDiv(kCLOCK_Sai1PreDiv, DEMO_SAI1_CLOCK_SOURCE_PRE_DIVIDER); <span class="comment">// 设置SAI1时钟的预分频器</span></span><br><span class="line">    CLOCK_SetDiv(kCLOCK_Sai1Div, DEMO_SAI1_CLOCK_SOURCE_DIVIDER); <span class="comment">// 设置SAI1时钟的分频器，共同决定 SAI的工作频率和MCLK频率</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*Enable MCLK clock*/</span></span><br><span class="line">    BOARD_EnableSaiMclkOutput(<span class="literal">true</span>); <span class="comment">// 使能SAI的主时钟(MCLK)输出。在这个例子中，SAI是master，会向codec输出MCLK。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Init DMAMUX */</span></span><br><span class="line">    DMAMUX_Init(DEMO_DMAMUX); <span class="comment">// 初始化DMA多路复用器，它负责将外设请求（如SAI的Tx/Rx完成）路由到特定的EDMA通道</span></span><br><span class="line">    DMAMUX_SetSource(DEMO_DMAMUX, DEMO_TX_EDMA_CHANNEL, (<span class="type">uint8_t</span>)DEMO_SAI_TX_SOURCE); <span class="comment">// 将SAI Tx的数据请求路由到EDMA的某个通道</span></span><br><span class="line">    DMAMUX_EnableChannel(DEMO_DMAMUX, DEMO_TX_EDMA_CHANNEL); <span class="comment">// 使能该EDMA通道的DMAMUX请求</span></span><br><span class="line">    DMAMUX_SetSource(DEMO_DMAMUX, DEMO_RX_EDMA_CHANNEL, (<span class="type">uint8_t</span>)DEMO_SAI_RX_SOURCE); <span class="comment">// 将SAI Rx的数据请求路由到EDMA的另一个通道</span></span><br><span class="line">    DMAMUX_EnableChannel(DEMO_DMAMUX, DEMO_RX_EDMA_CHANNEL); <span class="comment">// 使能该EDMA通道的DMAMUX请求</span></span><br><span class="line"></span><br><span class="line">    PRINTF(<span class="string">"SAI example started!\n\r"</span>); <span class="comment">// 打印启动信息</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Init DMA and create handle for DMA */</span></span><br><span class="line">    EDMA_GetDefaultConfig(&amp;dmaConfig); <span class="comment">// 获取EDMA默认配置</span></span><br><span class="line">    EDMA_Init(DEMO_DMA, &amp;dmaConfig); <span class="comment">// 初始化EDMA控制器</span></span><br><span class="line">    EDMA_CreateHandle(&amp;dmaTxHandle, DEMO_DMA, DEMO_TX_EDMA_CHANNEL); <span class="comment">// 为SAI Tx创建一个EDMA句柄</span></span><br><span class="line">    EDMA_CreateHandle(&amp;dmaRxHandle, DEMO_DMA, DEMO_RX_EDMA_CHANNEL); <span class="comment">// 为SAI Rx创建一个EDMA句柄</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* SAI init */</span></span><br><span class="line">    SAI_Init(DEMO_SAI); <span class="comment">// 初始化SAI外设模块本身</span></span><br><span class="line">    SAI_TransferTxCreateHandleEDMA(DEMO_SAI, &amp;txHandle, tx_callback, <span class="literal">NULL</span>, &amp;dmaTxHandle); <span class="comment">// 为SAI Tx创建EDMA传输句柄，关联SAI模块、EDMA句柄和Tx完成回调函数</span></span><br><span class="line">    SAI_TransferRxCreateHandleEDMA(DEMO_SAI, &amp;rxHandle, rx_callback, <span class="literal">NULL</span>, &amp;dmaRxHandle); <span class="comment">// 为SAI Rx创建EDMA传输句柄，关联SAI模块、EDMA句柄和Rx完成回调函数</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* I2S mode configurations */</span></span><br><span class="line">    SAI_GetClassicI2SConfig(&amp;saiConfig, DEMO_AUDIO_BIT_WIDTH, kSAI_Stereo, <span class="number">1U</span> &lt;&lt; DEMO_SAI_CHANNEL); <span class="comment">// 获取标准的I2S模式配置，比如位宽、声道等</span></span><br><span class="line">    saiConfig.syncMode              = DEMO_SAI_TX_SYNC_MODE; <span class="comment">// 设置Tx同步模式（这里是异步）</span></span><br><span class="line">    saiConfig.bitClock.bclkPolarity = DEMO_SAI_TX_BIT_CLOCK_POLARITY; <span class="comment">// 设置位时钟极性</span></span><br><span class="line">    saiConfig.masterSlave           = DEMO_SAI_MASTER_SLAVE; <span class="comment">// // 设置SAI模块在BCLK和LRCLK方面是Slave</span></span><br><span class="line">    SAI_TransferTxSetConfigEDMA(DEMO_SAI, &amp;txHandle, &amp;saiConfig); <span class="comment">// 将配置应用到SAI Tx EDMA句柄</span></span><br><span class="line">    saiConfig.syncMode = DEMO_SAI_RX_SYNC_MODE; <span class="comment">// 设置Rx同步模式（这里是同步，与Tx异步工作）</span></span><br><span class="line">    SAI_TransferRxSetConfigEDMA(DEMO_SAI, &amp;rxHandle, &amp;saiConfig); <span class="comment">// 将配置应用到SAI Rx EDMA句柄</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* set bit clock divider */</span></span><br><span class="line">    SAI_TxSetBitClockRate(DEMO_SAI, DEMO_AUDIO_MASTER_CLOCK, DEMO_AUDIO_SAMPLE_RATE, DEMO_AUDIO_BIT_WIDTH,</span><br><span class="line">                          DEMO_AUDIO_DATA_CHANNEL); <span class="comment">// 设置SAI Tx的位时钟速率，基于MCLK、采样率、位宽和通道数计算</span></span><br><span class="line">    SAI_RxSetBitClockRate(DEMO_SAI, DEMO_AUDIO_MASTER_CLOCK, DEMO_AUDIO_SAMPLE_RATE, DEMO_AUDIO_BIT_WIDTH,</span><br><span class="line">                          DEMO_AUDIO_DATA_CHANNEL); <span class="comment">// 设置SAI Rx的位时钟速率</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* master clock configurations */</span></span><br><span class="line">    BOARD_MASTER_CLOCK_CONFIG(); <span class="comment">// 这是一个宏，可能包含额外的MCLK配置，根据实际板级定义来确定具体功能</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Use default setting to init codec */</span></span><br><span class="line">    <span class="keyword">if</span> (CODEC_Init(&amp;codecHandle, &amp;boardCodecConfig) != kStatus_Success) <span class="comment">// 初始化音频编解码器(codec)，这里是WM8960</span></span><br><span class="line">    {</span><br><span class="line">        assert(<span class="literal">false</span>); <span class="comment">// 如果初始化失败，停止程序</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (CODEC_SetVolume(&amp;codecHandle, kCODEC_PlayChannelHeadphoneLeft | kCODEC_PlayChannelHeadphoneRight,</span><br><span class="line">                        DEMO_CODEC_VOLUME) != kStatus_Success) <span class="comment">// 设置耳机输出音量</span></span><br><span class="line">    {</span><br><span class="line">        assert(<span class="literal">false</span>); <span class="comment">// 如果设置音量失败，停止程序</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- 主循环：音频录制和播放的实时处理 ---</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 录制部分 (RX)</span></span><br><span class="line">        <span class="keyword">if</span> (emptyBlock &gt; <span class="number">0</span>) <span class="comment">// 检查是否有空的缓冲区可以用于接收（录制）音频数据</span></span><br><span class="line">        {</span><br><span class="line">            xfer.data     = Buffer + rx_index * BUFFER_SIZE; <span class="comment">// 设置本次EDMA接收传输的目标地址为当前可用的缓冲区</span></span><br><span class="line">            xfer.dataSize = BUFFER_SIZE; <span class="comment">// 设置本次传输的数据大小（缓冲区大小）</span></span><br><span class="line">            <span class="keyword">if</span> (kStatus_Success == SAI_TransferReceiveEDMA(DEMO_SAI, &amp;rxHandle, &amp;xfer)) <span class="comment">// 启动一次SAI通过EDMA的接收传输</span></span><br><span class="line">            {</span><br><span class="line">                rx_index++; <span class="comment">// 接收缓冲区索引递增，指向下一个缓冲区</span></span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (rx_index == BUFFER_NUMBER) <span class="comment">// 如果索引达到缓冲区总数，循环回到第一个缓冲区</span></span><br><span class="line">            {</span><br><span class="line">                rx_index = <span class="number">0U</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 播放部分 (TX)</span></span><br><span class="line">        <span class="keyword">if</span> (emptyBlock &lt; BUFFER_NUMBER) <span class="comment">// 检查是否有已填充（录制完成）的缓冲区可以用于发送（播放）音频数据</span></span><br><span class="line">        {</span><br><span class="line">            xfer.data     = Buffer + tx_index * BUFFER_SIZE; <span class="comment">// 设置本次EDMA发送传输的数据源地址为当前待播放的缓冲区</span></span><br><span class="line">            xfer.dataSize = BUFFER_SIZE; <span class="comment">// 设置本次传输的数据大小</span></span><br><span class="line">            <span class="keyword">if</span> (kStatus_Success == SAI_TransferSendEDMA(DEMO_SAI, &amp;txHandle, &amp;xfer)) <span class="comment">// 启动一次SAI通过EDMA的发送传输</span></span><br><span class="line">            {</span><br><span class="line">                tx_index++; <span class="comment">// 发送缓冲区索引递增，指向下一个待播放的缓冲区</span></span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (tx_index == BUFFER_NUMBER) <span class="comment">// 如果索引达到缓冲区总数，循环回到第一个缓冲区</span></span><br><span class="line">            {</span><br><span class="line">                tx_index = <span class="number">0U</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// emptyBlock 变量在这里是关键：</span></span><br><span class="line">        <span class="comment">// - 当 EDMA 完成一次 RX (录制) 传输时，`rx_callback` 会被调用，将 `emptyBlock` 减一，表示一个缓冲区被数据填满，不再是空的。</span></span><br><span class="line">        <span class="comment">// - 当 EDMA 完成一次 TX (播放) 传输时，`tx_callback` 会被调用，将 `emptyBlock` 加一，表示一个缓冲区的数据被发送完，变为空闲状态。</span></span><br><span class="line">        <span class="comment">// - 通过判断 `emptyBlock` 的值，主循环知道哪些缓冲区可以用来录制 (emptyBlock &gt; 0)，哪些缓冲区有数据可以播放 (emptyBlock &lt; BUFFER_NUMBER)。</span></span><br><span class="line">        <span class="comment">// - 这里的逻辑实现了一个简单的“乒乓”缓冲或者循环缓冲机制，确保录制和播放能够连续进行。</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p>工作流程和逻辑总结：</p>
<ol>
<li>初始化阶段：</li>
</ol>
<ul>
<li><p>系统、引脚、时钟等基础硬件被配置。</p>
</li>
<li><p>**<u>音频PLL被设置</u>**，为SAI提供精确时钟。</p>
</li>
<li><p><strong><u>用于codec控制的I2C</u></strong> 和 <strong><u>用于音频数据传输的SAI</u></strong> 的时钟被配置。</p>
</li>
<li><p><span style="color: blue; font-weight: bold;">SAI的MCLK输出被使能，为外部codec提供工作时钟。</span></p>
</li>
<li><p>DMAMUX被配置，将SAI的Tx和Rx请求连接到指定的EDMA通道。</p>
</li>
<li><p>EDMA控制器被初始化，并为SAI的Tx和Rx创建了EDMA句柄，准备好进行数据传输。</p>
</li>
<li><p>SAI外设本身被初始化。</p>
</li>
<li><p>为SAI的Tx和Rx功能创建了EDMA传输句柄，这些句柄关联了SAI模块、对应的EDMA句柄以及传输完成后的回调函数 (<code>tx_callback</code> 和 <code>rx_callback</code>)。</p>
</li>
<li><p>**<u>SAI被配置为I2S模式</u>**，设置了位宽、声道、同步模式（Rx同步于Tx位时钟，Tx异步）、主从模式等参数。</p>
<blockquote>
<p>此时，Codec是master，SAI是slave。</p>
</blockquote>
</li>
<li><p>计算并设置了SAI的 <strong>位时钟速率</strong>。</p>
</li>
<li><p>音频codec (WM8960) 通过I2C接口被初始化和配置（包括音量设置）。</p>
</li>
</ul>
<hr>
<ol start="2">
<li>数据传输阶段 (主循环 while(1))：</li>
</ol>
<ul>
<li><p>工程使用了多个（<code>BUFFER_NUMBER</code>，这里是4个）大小为 <code>BUFFER_SIZE</code> (这里是1024字节) 的缓冲区 (Buffer 数组)。</p>
</li>
<li><p><code>emptyBlock</code> 变量跟踪当前有多少个缓冲区是空的。初始时，所有缓冲区都是空的，<code>emptyBlock</code> 等于 <code>BUFFER_NUMBER</code>。</p>
</li>
<li><p><code>rx_index</code> 指向下一个用于接收（录制）数据的缓冲区。</p>
</li>
<li><p><code>tx_index</code> 指向下一个用于发送（播放）数据的缓冲区。</p>
</li>
<li><p>录制逻辑： </p>
<blockquote>
<p>如果 <code>emptyBlock &gt; 0</code> (有空缓冲区)，意味着可以启动一次新的接收传输。工程设置下一个 空缓冲区 为目标，启动一个EDMA接收任务。EDMA会自动将SAI接收到的数据传输到指定的缓冲区中。传输完成后，会触发 <code>rx_callback</code>，将 <code>emptyBlock</code> 减一，并更新 <code>rx_index</code>。</p>
</blockquote>
</li>
<li><p>播放逻辑： </p>
<blockquote>
<p>如果 <code>emptyBlock</code> &lt; <code>BUFFER_NUMBER</code> (有非空缓冲区)，意味着有数据可以播放。工程设置下一个 待播放的缓冲区 为 数据源，启动一个EDMA发送任务。</p>
<p>EDMA会自动将缓冲区中的数据传输到SAI，SAI再发送给codec进行播放。传输完成后，会触发 <code>tx_callback</code>，将 <code>emptyBlock</code> 加一，并更新 <code>tx_index</code>。</p>
</blockquote>
</li>
<li><p><code>rx_index</code> 和 <code>tx_index</code> 在达到缓冲区末尾时会循环回0，形成一个循环缓冲队列。</p>
</li>
<li><p><span style="color: red; font-weight: bold;">通过这种方式，当录制EDMA完成一个缓冲区时，<code>emptyBlock</code> 减少，主循环就可以尽快启动播放该缓冲区；当播放EDMA完成一个缓冲区时，<code>emptyBlock</code> 增加，主循环就可以尽快将该缓冲区再次用于录制。这实现了音频数据的实时“录放”（Capture-Playback）。</span></p>
</li>
</ul>
<ol start="3">
<li>回调函数 (<code>rx_callback</code> 和 <code>tx_callback</code>)：</li>
</ol>
<ul>
<li><p>这两个函数在对应的EDMA传输完成时由SAI EDMA驱动调用。</p>
</li>
<li><p>它们的主要作用是更新 <code>emptyBlock</code> 的计数器。<code>rx_callback</code> (接收完成) 减少 <code>emptyBlock</code>，<code>tx_callback</code> (发送完成) 增加 <code>emptyBlock</code>。</p>
</li>
<li><p>它们也包含基本的错误处理（虽然这里的实现只是检查状态而没有具体处理）。</p>
</li>
</ul>
<p>总的来说，这个工程通过配置SAI和EDMA，建立了一个高效的音频数据通道。数据通过EDMA从SAI Rx（录音输入）传输到内存缓冲区，然后再通过EDMA从内存缓冲区传输到SAI Tx（播放输出）。main 函数中的 while(1) 循环负责检查缓冲区的状态 (emptyBlock) 并不断启动新的EDMA传输任务，从而实现连续的音频录制和播放功能。回调函数是这个EDMA驱动模型的关键部分，它们在外设事件（传输完成）发生时被调用，通知主程序更新状态并安排下一个任务。</p>
<h2 id="2-几个时钟的区分"><a href="#2-几个时钟的区分" class="headerlink" title="2. 几个时钟的区分"></a>2. 几个时钟的区分</h2><p>在I2S（或其他类似的串行音频接口）通信中，有几种不同的时钟信号：</p>
<ul>
<li><p><code>MCLK</code> (Master Clock / System Clock): 通常是频率最高的时钟，用于驱动Codec的内部电路和PLL。</p>
</li>
<li><p><code>BCLK</code> (Bit Clock): 位时钟，每个音频数据位对应一个BCLK周期。</p>
</li>
<li><p><code>LRCLK</code> (Left/Right Clock / Frame Sync): 左右时钟或帧同步信号，指示当前传输的是左声道还是右声道数据，并同步一个音频帧的开始。（也是字选择信号）</p>
</li>
</ul>
<p>时钟的主从关系主要体现在 <code>BCLK</code> 和 <code>LRCLK</code> 上。配置为 I2S Master 的设备会 生成并输出 BCLK 和 LRCLK；配置为 I2S Slave 的设备会 接收 BCLK 和 LRCLK。</p>
<p>然而，MCLK 的主从关系是相对独立的。在一个典型的系统中，通常有一个设备负责产生高频的MCLK来驱动整个音频链路。这个设备可以是由主控芯片（MCU）通过其某个时钟生成单元产生，也可以由外部的Codec自己产生（这种情况较少见）。</p>
<p>在工程中，<code>BOARD_EnableSaiMclkOutput(true)</code> 函数的作用是配置MIMXRT1060芯片上SAI1模块的MCLK引脚，使其作为 输出 引脚。这意味着芯片正在 产生并输出 MCLK。这个MCLK通常是由芯片内部的音频PLL (<code>CLOCK_InitAudioPll</code>) 产生，然后通过SAI模块的MCLK引脚输出到外部的WM8960 Codec。</p>
<h2 id="3-位时钟是怎么产生的"><a href="#3-位时钟是怎么产生的" class="headerlink" title="3. 位时钟是怎么产生的"></a>3. 位时钟是怎么产生的</h2><p>来仔细看 <code>SAI_TxSetBitClockRate</code> 和 <code>SAI_RxSetBitClockRate</code> 这两个函数及其实现的逻辑。它们的核心功能是根据期望的音频参数（<strong>采样率、位宽、通道数</strong>）来计算并配置SAI模块的 <strong>位时钟 (BCLK)</strong> 相关的寄存器设置。</p>
<p><strong>1. <code>SAI_TxSetBitClockRate</code> 函数 (配置发送功能的位时钟速率)</strong></p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span></span><br><span class="line"><span class="comment"> * brief Transmitter bit clock rate configurations.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * param base SAI base pointer. // SAI模块的基地址，指向具体的SAI实例（比如SAI1）</span></span><br><span class="line"><span class="comment"> * param sourceClockHz, bit clock source frequency. // 位时钟的源频率，通常是MCLK或者其他的SAI时钟源频率</span></span><br><span class="line"><span class="comment"> * param sampleRate audio data sample rate. // 音频采样率 (Hz)，比如 16000 Hz (16KHz)</span></span><br><span class="line"><span class="comment"> * param bitWidth, audio data bitWidth. // 音频数据位宽 (bits)，比如 16 bits</span></span><br><span class="line"><span class="comment"> * param channelNumbers, audio channel numbers. // 音频通道数，比如 2 (立体声)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">SAI_TxSetBitClockRate</span><span class="params">(</span></span><br><span class="line"><span class="params">    I2S_Type *base, <span class="type">uint32_t</span> sourceClockHz, <span class="type">uint32_t</span> sampleRate, <span class="type">uint32_t</span> bitWidth, <span class="type">uint32_t</span> channelNumbers)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">uint32_t</span> tcr2         = base-&gt;TCR2; <span class="comment">// 读取SAI发送配置寄存器2 (TCR2) 的当前值</span></span><br><span class="line">    <span class="type">uint32_t</span> bitClockDiv  = <span class="number">0</span>; <span class="comment">// 用于存储计算出的位时钟分频值</span></span><br><span class="line">    <span class="type">uint32_t</span> bitClockFreq = sampleRate * bitWidth * channelNumbers; <span class="comment">// 计算目标位时钟频率： 采样率 * 位宽 * 通道数 = 每秒传输的总位数 = BCLK频率</span></span><br><span class="line"></span><br><span class="line">    assert(sourceClockHz &gt;= bitClockFreq); <span class="comment">// 断言：源时钟频率必须大于等于目标位时钟频率，否则无法通过分频得到</span></span><br><span class="line"></span><br><span class="line">    tcr2 &amp;= ~I2S_TCR2_DIV_MASK; <span class="comment">// 清除TCR2寄存器中位时钟分频器 (DIV) 字段的当前值</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* need to check the divided bclk, if bigger than target, then divider need to re-calculate. */</span></span><br><span class="line">    bitClockDiv = sourceClockHz / bitClockFreq; <span class="comment">// 初步计算分频值： 源频率 / 目标频率</span></span><br><span class="line">    <span class="comment">/* for the condition where the source clock is smaller than target bclk */</span></span><br><span class="line">    <span class="keyword">if</span> (bitClockDiv == <span class="number">0U</span>) <span class="comment">// 如果源频率小于目标频率（理论上不应该发生，但为了安全检查），分频值至少设为1</span></span><br><span class="line">    {</span><br><span class="line">        bitClockDiv++;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/* recheck the divider if properly or not, to make sure output blck not bigger than target*/</span></span><br><span class="line">    <span class="comment">// 重新检查计算出的分频值是否合适，确保分频后的位时钟频率不会高于目标频率。</span></span><br><span class="line">    <span class="comment">// 这里的逻辑是通过 integer division 的特性来确保分频值是足够大的整数。</span></span><br><span class="line">    <span class="comment">// 如果 `sourceClockHz / bitClockDiv` 仍然大于 `bitClockFreq`，说明 `bitClockDiv` 偏小，需要再加1。</span></span><br><span class="line">    <span class="keyword">if</span> ((sourceClockHz / bitClockDiv) &gt; bitClockFreq)</span><br><span class="line">    {</span><br><span class="line">        bitClockDiv++;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 设置TCR2寄存器的DIV字段。</span></span><br><span class="line">        <span class="comment">// 注意这里的 `bitClockDiv / 2U - 1UL`：</span></span><br><span class="line">        <span class="comment">// 大多数恩智浦微控制器的SAI模块的DIV字段配置的是 (分频值 / 2) - 1。</span></span><br><span class="line">        <span class="comment">// 例如，如果需要分频64，DIV寄存器需要设置为 (64 / 2) - 1 = 31。</span></span><br><span class="line">        <span class="comment">// 这里的代码就是根据计算出的总分频值 `bitClockDiv` 来得到寄存器实际需要写入的值。</span></span><br><span class="line">        tcr2 |= I2S_TCR2_DIV(bitClockDiv / <span class="number">2U</span> - <span class="number">1UL</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    base-&gt;TCR2 = tcr2; <span class="comment">// 将修改后的TCR2值写回寄存器，应用配置</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>核心逻辑 (SAI_TxSetBitClockRate):</strong></p>
<ol>
<li>计算目标位时钟频率 (<code>bitClockFreq</code>)：这是由音频格式（采样率、位宽、通道数）决定的，表示每秒需要传输的总位数。</li>
<li>计算所需的时钟源到目标位时钟频率的总分频比 (<code>bitClockDiv</code>)： <code>源时钟频率 / 目标位时钟频率</code>。</li>
<li>对计算出的分频比进行调整，确保分频结果不会高于目标频率。</li>
<li>根据计算出的分频比和硬件寄存器的编码方式（除以2减1）计算要写入寄存器的值。</li>
<li>将计算出的分频值写入SAI发送配置寄存器2 (<code>TCR2</code>) 的相应位字段 (<code>DIV</code>)。</li>
</ol>
<p><strong>2. <code>SAI_RxSetBitClockRate</code> 函数 (配置接收功能的位时钟速率)</strong></p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span></span><br><span class="line"><span class="comment"> * brief Receiver bit clock rate configurations.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * param base SAI base pointer. // SAI模块的基地址</span></span><br><span class="line"><span class="comment"> * param sourceClockHz, bit clock source frequency. // 位时钟的源频率</span></span><br><span class="line"><span class="comment"> * param sampleRate audio data sample rate. // 音频采样率</span></span><br><span class="line"><span class="comment"> * param bitWidth, audio data bitWidth. // 音频数据位宽</span></span><br><span class="line"><span class="comment"> * param channelNumbers, audio channel numbers. // 音频通道数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">SAI_RxSetBitClockRate</span><span class="params">(</span></span><br><span class="line"><span class="params">    I2S_Type *base, <span class="type">uint32_t</span> sourceClockHz, <span class="type">uint32_t</span> sampleRate, <span class="type">uint32_t</span> bitWidth, <span class="type">uint32_t</span> channelNumbers)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">uint32_t</span> rcr2         = base-&gt;RCR2; <span class="comment">// 读取SAI接收配置寄存器2 (RCR2) 的当前值</span></span><br><span class="line">    <span class="type">uint32_t</span> bitClockDiv  = <span class="number">0</span>; <span class="comment">// 用于存储计算出的位时钟分频值</span></span><br><span class="line">    <span class="type">uint32_t</span> bitClockFreq = sampleRate * bitWidth * channelNumbers; <span class="comment">// 计算目标位时钟频率，与发送功能相同</span></span><br><span class="line"></span><br><span class="line">    assert(sourceClockHz &gt;= bitClockFreq); <span class="comment">// 断言：源时钟频率必须大于等于目标位时钟频率</span></span><br><span class="line"></span><br><span class="line">    rcr2 &amp;= ~I2S_RCR2_DIV_MASK; <span class="comment">// 清除RCR2寄存器中位时钟分频器 (DIV) 字段的当前值</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* need to check the divided bclk, if bigger than target, then divider need to re-calculate. */</span></span><br><span class="line">    bitClockDiv = sourceClockHz / bitClockFreq; <span class="comment">// 初步计算分频值</span></span><br><span class="line">    <span class="comment">/* for the condition where the source clock is smaller than target bclk */</span></span><br><span class="line">    <span class="keyword">if</span> (bitClockDiv == <span class="number">0U</span>) <span class="comment">// 检查分频值是否为0</span></span><br><span class="line">    {</span><br><span class="line">        bitClockDiv++;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/* recheck the divider if properly or not, to make sure output blck not bigger than target*/</span></span><br><span class="line">    <span class="comment">// 重新检查分频值，确保分频后的位时钟不高于目标频率</span></span><br><span class="line">    <span class="keyword">if</span> ((sourceClockHz / bitClockDiv) &gt; bitClockFreq)</span><br><span class="line">    {</span><br><span class="line">        bitClockDiv++;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 设置RCR2寄存器的DIV字段，同样是除以2减1的编码方式</span></span><br><span class="line">        rcr2 |= I2S_RCR2_DIV(bitClockDiv / <span class="number">2U</span> - <span class="number">1UL</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    base-&gt;RCR2 = rcr2; <span class="comment">// 将修改后的RCR2值写回寄存器，应用配置</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>核心逻辑 (SAI_RxSetBitClockRate):</strong></p>
<p>这个函数与 <code>SAI_TxSetBitClockRate</code> 的逻辑完全相同。唯一的区别在于，它操作的是SAI接收配置寄存器2 (<code>RCR2</code>) 的 <code>DIV</code> 位字段 (<code>I2S_RCR2_DIV_MASK</code>)。</p>
<p><strong>为什么在 Slave 模式下也调用这些函数？</strong></p>
<p>在这个工程中，SAI 被配置为 BCLK/LRCLK 的 Slave。在 Slave 模式下，SAI 不会通过其内部的分频器生成 BCLK，而是从外部设备（Codec Master）接收 BCLK。</p>
<p>在具体工程中，由于 SAI 被明确配置为 Slave (<code>kSAI_Slave</code>)，最重要的时钟（BCLK 和 LRCLK）实际上是由 Codec Master 产生的。MCU SAI 模块通过接收这些外部时钟来同步数据的发送和接收。因此，虽然代码中调用了 <code>SetBitClockRate</code> 函数，其主要作用可能不是用于配置时钟生成硬件（因为是 Slave 模式），而是计算分频并写入寄存器，方便后面使用。</p>
<p>来深入分析一下 Codec (WM8960) 如何在主模式下计算和产生 BCLK，以及代码中哪里体现了这一点。</p>
<p>当我们说 Codec 工作在 I2S 主模式 (Master) 时，这意味着它负责根据音频格式（采样率、位宽、通道数）来生成并输出 位时钟 (BCLK) 和 帧同步信号 (LRCLK)。它通常依赖于一个主时钟 (MCLK) 来驱动其内部时钟生成电路（如 PLL 和分频器）。</p>
<p>在这个工程中：</p>
<ol>
<li><p>MCLK 源： 微控制器 (MIMXRT1060) 通过 SAI 的 MCLK 输出引脚提供 MCLK 给 WM8960 Codec。我们在 main.c 中配置并使能了这个输出 (BOARD_EnableSaiMclkOutput(true))。MCLK 的频率是根据音频 PLL 和 SAI 的时钟分频器设置得出的，main.c 中通过 DEMO_SAI_CLK_FREQ 宏定义来表示这个频率。</p>
</li>
<li><p>音频格式信息： Codec 需要知道要传输的音频数据的格式，才能计算出正确的 BCLK 频率。这些信息在 wm8960Config 结构体中进行了配置，并在初始化 Codec 时通过 CODEC_Init 函数传递给了 WM8960 驱动：</p>
</li>
</ol>
<ul>
<li><p><code>.format.sampleRate = kWM8960_AudioSampleRate16KHz</code>: 设定采样率为 16KHz。</p>
</li>
<li><p><code>.format.bitWidth = kWM8960_AudioBitWidth16bit</code>: 设定数据位宽为 16 bit。</p>
</li>
<li><p><code>.bus = kWM8960_BusI2S</code>: 设定使用标准的 I2S 格式。标准 I2S 格式下，一个立体声采样周期需要传输 <code>2 * bitWidth</code> 的数据位（对于 16bit stereo 就是 32 位）。</p>
</li>
<li><p><code>.format.mclk_HZ = 6144000U * 2</code>: 设定 Codec 接收到的 MCLK 频率。这里计算出来是 12.288 MHz。这与 <code>DEMO_SAI_CLK_FREQ</code> 理论上应该匹配。</p>
</li>
</ul>
<ol start="3">
<li>Codec 如何计算 BCLK： Codec 内部有专门的时钟生成硬件。当 Codec 被配置为 I2S Master 并接收到 MCLK 后，它会根据接收到的 MCLK 频率 (format.mclk_HZ) 和配置的音频格式（采样率、位宽、总线格式）来计算并生成 BCLK 和 LRCLK。</li>
</ol>
<ul>
<li><p>对于标准的 I2S 格式，所需的 BCLK 频率通常是 采样率 * 每帧总位数。对于 16 位立体声，每帧是 32 位（16位左声道 + 16位右声道）。所以理论上 BCLK 频率应为 16KHz * 32 = 512 KHz。</p>
</li>
<li><p>Codec 内部的 PLL 和分频器会利用 MCLK (12.288 MHz) 来尝试生成这个 512 KHz 的 BCLK。例如，12.288 MHz / 512 KHz = 24。所以 Codec 内部可能需要将 MCLK 分频 24 倍来得到 BCLK。</p>
</li>
<li><p>LRCLK 的频率就是采样率，即 16 KHz。LRCLK 通常是 BCLK 的一个分频（对于 16 位立体声 I2S，LRCLK 频率是 BCLK 频率的 1/32）。</p>
</li>
</ul>
<ol start="4">
<li>代码中的体现：</li>
</ol>
<ul>
<li><p>wm8960Config 结构体中的 <code>.master_slave = true</code> 指明了 Codec 是 Master。</p>
</li>
<li><p>wm8960Config.format 中的 <code>.sampleRate</code> 和 <code>.bitWidth</code> 提供了 Codec 计算 BCLK 所需的音频格式信息。</p>
</li>
<li><p>wm8960Config.format.mclk_HZ 告知 Codec 它接收到的 MCLK 频率是多少，这是它进行内部时钟生成的输入。</p>
</li>
<li><p>Codec 驱动 (fsl_wm8960.c) 的作用： 虽然我们没有直接看到 WM8960 驱动中计算 BCLK 的 C 代码（因为时钟生成是 Codec 硬件的功能，驱动主要通过 I2C 配置 Codec 寄存器），但 <code>CODEC_Init</code> (在 fsl_codec_adapter.c 中调用 WM8960 驱动的初始化函数) 会读取 wm8960Config 中的这些参数，并通过 I2C 接口将它们写入 WM8960 Codec 的内部配置寄存器。</p>
</li>
<li><p>WM8960 Datasheet/Reference Manual： Codec 如何根据这些配置计算 BCLK 的具体细节（如内部 PLL 配置、分频器寄存器设置等）通常会在 WM8960 的数据手册或参考手册中详细说明。驱动程序 fsl_wm8960.c 就是根据这个手册来实现通过 I2C 配置 Codec 寄存器的逻辑。驱动会解析 wm8960Config 中的参数，并翻译成 Codec 寄存器中对应的位域值。</p>
</li>
</ul>
<p>总结：</p>
<p>当 SAI 是 Slave 时，BCLK 是由 Codec (WM8960) 产生的。CodeC 作为 I2S Master，利用从微控制器接收到的 MCLK，并根据通过 I2C 接口由 Codec 驱动 (fsl_wm8960.c) 写入其内部寄存器的音频格式配置（采样率、位宽、总线格式等），通过其内部的时钟生成电路（PLL 和分频器）计算并生成所需的 BCLK 和 LRCLK。微控制器的 SAI 驱动代码通过 wm8960Config 和 CODEC_Init 将音频格式和 MCLK 频率信息传递给 Codec 驱动，由 Codec 驱动负责通过 I2C 将这些配置应用到 WM8960 硬件，CodeC 硬件本身负责根据这些配置生成 BCLK。</p>
<h2 id="4-时钟总结"><a href="#4-时钟总结" class="headerlink" title="4. 时钟总结"></a>4. 时钟总结</h2><p>好的，没问题。根据我们之前的讨论，我为你绘制一个简单的文本图，希望能帮助你更清晰地理解整个系统中各个外设的作用、连接关系以及时钟和数据流。</p>
<figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">+----------------------------------------------------------------+</span><br><span class="line">|                    微控制器 (MIMXRT1060)                       |</span><br><span class="line">|                                                                |</span><br><span class="line">| +---------------------------+                                  |</span><br><span class="line">| | Audio PLL &amp; 时钟生成单元  | -- MCLK (主时钟输出) --&gt; +-----+ |</span><br><span class="line">| +---------------------------+                        |     | |</span><br><span class="line">|                                                      |     | |</span><br><span class="line">| +---------------------------+                        |     | |</span><br><span class="line">| | LPI2C1 (I2C控制器)        | -- I2C总线 (配置信息) -&gt; |     | |</span><br><span class="line">| +---------------------------+                        |     | |</span><br><span class="line">|                                                      |     | |</span><br><span class="line">| +---------------------------+ &lt;- BCLK (位时钟输入) ----+     | |</span><br><span class="line">| | SAI1 (串行音频接口)        | &lt;- LRCLK (帧同步输入) --+ WM8960 Codec |</span><br><span class="line">| |   (BCLK/LRCLK 从设备)     |                          |     | |</span><br><span class="line">| |                           |                          |  (BCLK/LRCLK|</span><br><span class="line">| | +---------------------+   | &lt;--- 数字音频数据 (RX) ---+  主设备,   |</span><br><span class="line">| | | SAI1 RX FIFO (接收) |&lt;--+                          |   MCLK 输入)|</span><br><span class="line">| | +---------------------+   | EDMA传输请求(RX)         |     | |</span><br><span class="line">| |        |                  +------------------------+-----+ |</span><br><span class="line">| |        |                                                  |</span><br><span class="line">| | +---------------------+   | ---&gt; 数字音频数据 (TX) ---&gt; +-----+</span><br><span class="line">| | | SAI1 TX FIFO (发送) |--&gt;+ Codec (通过其DAC输出模拟音频)--&gt;+耳机/扬声器|</span><br><span class="line">| | +---------------------+   | EDMA传输请求(TX)         +-----+-------+</span><br><span class="line">| |        ^                  +------------------------+</span><br><span class="line">| +---------------------------+                                  |</span><br><span class="line">|            |                                                   |</span><br><span class="line">| +---------------------------+                                  |</span><br><span class="line">| | DMAMUX (DMA多路复用器)    | -- 路由EDMA请求 --&gt; +-----------+ |</span><br><span class="line">| |        ^                  |                     |  麦克风   | |</span><br><span class="line">| +---------------------------+                     +-----------+ |</span><br><span class="line">|            | EDMA请求                                         |</span><br><span class="line">| +---------------------------+                                  |</span><br><span class="line">| | EDMA (增强型DMA控制器)    |                                  |</span><br><span class="line">| |   (通道 RX 和 TX)         | &lt;--- EDMA传输 (数据)             |</span><br><span class="line">| |        |                  |                                  |</span><br><span class="line">| | +---------------------+   | ---&gt; EDMA传输 (数据) --&gt; +-------------+ |</span><br><span class="line">| | | EDMA Channel RX     | --+                         | 内存缓冲区  | |</span><br><span class="line">| | +---------------------+   |                         +-------------+ |</span><br><span class="line">| | +---------------------+   | &lt;--- EDMA传输 (数据)             |</span><br><span class="line">| | | EDMA Channel TX     | &lt;--+                                  |</span><br><span class="line">| | +---------------------+                                  |</span><br><span class="line">| +---------------------------+                                  |</span><br><span class="line">+----------------------------------------------------------------+</span><br></pre></td></tr></tbody></table></figure>

<p><strong>图解说明：</strong></p>
<ol>
<li><p><strong>MIMXRT1060:</strong> 整个系统的核心。</p>
<ul>
<li><strong>Audio PLL &amp; 时钟生成单元:</strong> 产生高频的音频主时钟 (MCLK)，并通过 SAI1 模块输出给 Codec。</li>
<li><strong>LPI2C1:</strong> 作为 I2C 主设备，用于通过 I2C 总线向 WM8960 Codec 发送配置命令（如设置采样率、音量、主从模式等）。</li>
<li><strong>SAI1:</strong> 串行音频接口，配置为 **BCLK/LRCLK 的从设备 (Slave)**。它接收来自 Codec 的 BCLK 和 LRCLK 来同步数据传输，并通过数据引脚接收录音数据 (RX) 并发送播放数据 (TX)。<ul>
<li><strong>SAI1 RX FIFO:</strong> 接收来自 Codec 的数字音频数据，并将数据暂存起来。当 FIFO 达到一定阈值时，会触发 EDMA 传输请求。</li>
<li><strong>SAI1 TX FIFO:</strong> 接收来自 EDMA 的播放数据，并通过 SAI 接口发送给 Codec。当 FIFO 需要数据时，会触发 EDMA 传输请求。</li>
</ul>
</li>
<li><strong>DMAMUX:</strong> 将 SAI1 模块的 RX/TX EDMA 传输请求路由到特定的 EDMA 通道。</li>
<li><strong>EDMA:</strong> 增强型 DMA 控制器，负责在 SAI 的 FIFO 和内存缓冲区之间高效地传输音频数据，无需 CPU 干预。</li>
<li><strong>内存缓冲区:</strong> 位于微控制器 RAM 中的一块区域，用于临时存储录制到的音频数据，以及存放等待播放的音频数据。</li>
</ul>
</li>
<li><p><strong>外部设备:</strong></p>
<ul>
<li><strong>WM8960 Codec:</strong> 音频编解码器。<ul>
<li>接收微控制器提供的 MCLK。</li>
<li>接收微控制器通过 I2C 发送的配置命令。</li>
<li>作为 **BCLK/LRCLK 的主设备 (Master)**，根据 MCLK 和配置信息，内部生成并输出 BCLK 和 LRCLK 给 SAI1。</li>
<li>将来自麦克风的模拟音频转换为数字音频 (ADC)，并通过数字音频输出引脚发送给 SAI1 RX FIFO。</li>
<li>将来自 SAI1 TX FIFO 的数字音频数据转换为模拟音频 (DAC)，并通过模拟音频输出引脚发送给耳机/扬声器。</li>
</ul>
</li>
<li><strong>麦克风:</strong> 提供模拟音频输入。</li>
<li><strong>耳机/扬声器:</strong> 输出模拟音频。</li>
</ul>
</li>
</ol>
<p><strong>时钟和数据流：</strong></p>
<ul>
<li><strong>时钟流：</strong> <code>MCLK</code> 从 MCU 流向 Codec；<code>BCLK</code> 和 <code>LRCLK</code> 从 Codec 流向 MCU (SAI1)。</li>
<li><strong>配置流：</strong> I2C 命令从 MCU 流向 Codec。</li>
<li><strong>数据流 (录音 - RX):</strong> 麦克风 (模拟) -&gt; Codec (ADC -&gt; 数字) -&gt; Codec 数字输出 -&gt; SAI1 RX FIFO -&gt; EDMA Channel RX -&gt; 内存缓冲区。这个过程由 Codec 生成的 BCLK 和 LRCLK 同步。</li>
<li><strong>数据流 (播放 - TX):</strong> 内存缓冲区 -&gt; EDMA Channel TX -&gt; SAI1 TX FIFO -&gt; SAI1 数字输出 -&gt; Codec (DAC -&gt; 模拟) -&gt; Codec 模拟输出 -&gt; 耳机/扬声器。这个过程也由 Codec 生成的 BCLK 和 LRCLK 同步。</li>
</ul>
<p>这个图和说明应该能清晰地展示出系统中各个组件的角色分工、连接方式以及音频数据和时钟的流动路径。</p>
<style>.qwyzwuoprsui{zoom:100%;}</style><img src="/NXP/RT1060/SAI/rt1060-evkmimxrt1060-sai-edma-record-playback-%E8%AF%A6%E8%A7%A3/RT1060_SAI_edma.png" class="qwyzwuoprsui">

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    subgraph MCU [MCU MIMXRT1060]</span><br><span class="line">        Clock(音频PLL 时钟)</span><br><span class="line">        I2C(LPI2C1 I2C Master)</span><br><span class="line">        SAI[SAI1 BCLK_LRCLK Slave]</span><br><span class="line">        DMAMUX[DMAMUX]</span><br><span class="line">        EDMA[EDMA Channel RX TX]</span><br><span class="line">        Memory[内存缓冲区]</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    Codec[WM8960 Codec&lt;br&gt;BCLK_LRCLK Master&lt;br&gt;MCLK Input]</span><br><span class="line">    Mic[麦克风]</span><br><span class="line">    Headphones[耳机 扬声器]</span><br><span class="line"></span><br><span class="line">    %% Clock Flow</span><br><span class="line">    Clock --&gt; Codec</span><br><span class="line"></span><br><span class="line">    %% Configuration Flow</span><br><span class="line">    I2C --&gt; Codec</span><br><span class="line"></span><br><span class="line">    %% Data and Clock Flow (Playback - TX)</span><br><span class="line">    Memory --&gt; EDMA</span><br><span class="line">    EDMA --&gt; SAI</span><br><span class="line">    SAI --&gt; Codec</span><br><span class="line">    SAI &lt;-- Codec</span><br><span class="line">    Codec --&gt; Headphones</span><br><span class="line"></span><br><span class="line">    %% Data Flow (Recording - RX)</span><br><span class="line">    Mic --&gt; Codec</span><br><span class="line">    Codec --&gt; SAI</span><br><span class="line">    SAI --&gt; DMAMUX</span><br><span class="line">    DMAMUX --&gt; EDMA</span><br><span class="line">    EDMA --&gt; Memory</span><br><span class="line"></span><br><span class="line">    %% Note on EDMA Trigger: SAI FIFOs trigger EDMA requests via DMAMUX</span><br><span class="line">    SAI --&gt; DMAMUX</span><br><span class="line">    DMAMUX --&gt; EDMA</span><br><span class="line">style Codec stroke:#FF0000</span><br></pre></td></tr></tbody></table></figure>





</div><div class="article-licensing box"><div class="licensing-title"><p>RT1060 evkmimxrt1060_sai_edma_record_playback 详解</p><p><a href="https://dustofstars.github.io/NXP/RT1060/SAI/rt1060-evkmimxrt1060-sai-edma-record-playback-详解/">https://dustofstars.github.io/NXP/RT1060/SAI/rt1060-evkmimxrt1060-sai-edma-record-playback-详解/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Gavin</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2025-05-28</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2025-05-28</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="" rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/NXP/">NXP</a><a class="link-muted mr-2" rel="tag" href="/tags/SAI/">SAI</a><a class="link-muted mr-2" rel="tag" href="/tags/eDMA/">eDMA</a></div><div class="sharethis-inline-share-buttons"></div><script src="//platform-api.sharethis.com/js/sharethis.js#property=5ab6f60ace89f00013641890&amp;product=inline-share-buttons" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/NXP/RT1060/eDMA/rt1060-edma-%E8%AF%A6%E8%A7%A3-3/"><span class="level-item">RT1060 eDMA 详解 (3)</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.png" alt="Gavin"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Gavin</p><p class="is-size-6 is-block">Embeded &amp; IC Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Shanghai, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives/"><p class="title">144</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories/"><p class="title">48</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags/"><p class="title">52</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/dustofstars/" target="_blank" rel="me noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/dustofstars/"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#evkmimxrt1060-sai-edma-record-playback"><span class="level-left"><span class="level-item">1</span><span class="level-item">evkmimxrt1060_sai_edma_record_playback</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#0-工程用到的外设拆解"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">0. 工程用到的外设拆解</span></span></a></li><li><a class="level is-mobile" href="#1-main函数主逻辑"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">1. main函数主逻辑</span></span></a></li><li><a class="level is-mobile" href="#2-几个时钟的区分"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">2. 几个时钟的区分</span></span></a></li><li><a class="level is-mobile" href="#3-位时钟是怎么产生的"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">3. 位时钟是怎么产生的</span></span></a></li><li><a class="level is-mobile" href="#4-时钟总结"><span class="level-left"><span class="level-item">1.5</span><span class="level-item">4. 时钟总结</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/ARM/"><span class="level-start"><span class="level-item">ARM</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/ARM/Boot/"><span class="level-start"><span class="level-item">Boot</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/ARM/MemoryMap/"><span class="level-start"><span class="level-item">MemoryMap</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/C/"><span class="level-start"><span class="level-item">C++</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/C/STL/"><span class="level-start"><span class="level-item">STL</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Configuration/"><span class="level-start"><span class="level-item">Configuration</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/IC%E9%AA%8C%E8%AF%81/"><span class="level-start"><span class="level-item">IC验证</span></span><span class="level-end"><span class="level-item tag">17</span></span></a><ul><li><a class="level is-mobile" href="/categories/IC%E9%AA%8C%E8%AF%81/%E6%BC%AB%E6%B8%B8%E6%8C%87%E5%8D%97/"><span class="level-start"><span class="level-item">漫游指南</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/IC%E9%AA%8C%E8%AF%81/%E8%B7%AF%E7%A7%91V0/"><span class="level-start"><span class="level-item">路科V0</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/IoT%E5%8D%8F%E8%AE%AE/"><span class="level-start"><span class="level-item">IoT协议</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/IoT%E5%8D%8F%E8%AE%AE/BLE/"><span class="level-start"><span class="level-item">BLE</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/IoT%E5%8D%8F%E8%AE%AE/Thread/"><span class="level-start"><span class="level-item">Thread</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/IoT%E5%8D%8F%E8%AE%AE/ZigBee/"><span class="level-start"><span class="level-item">ZigBee</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Leetcode/"><span class="level-start"><span class="level-item">Leetcode</span></span><span class="level-end"><span class="level-item tag">8</span></span></a><ul><li><a class="level is-mobile" href="/categories/Leetcode/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"><span class="level-start"><span class="level-item">数据结构</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/NLP/"><span class="level-start"><span class="level-item">NLP</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul><li><a class="level is-mobile" href="/categories/NLP/PyTorch/"><span class="level-start"><span class="level-item">PyTorch</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/NLP/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/NXP/"><span class="level-start"><span class="level-item">NXP</span></span><span class="level-end"><span class="level-item tag">33</span></span></a><ul><li><a class="level is-mobile" href="/categories/NXP/KW38/"><span class="level-start"><span class="level-item">KW38</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/NXP/KW38/GPIO%E4%B8%AD%E6%96%AD/"><span class="level-start"><span class="level-item">GPIO中断</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/NXP/RT1024/"><span class="level-start"><span class="level-item">RT1024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/NXP/RT1024/%E5%8E%9F%E7%90%86%E5%9B%BE/"><span class="level-start"><span class="level-item">原理图</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/NXP/RT1050/"><span class="level-start"><span class="level-item">RT1050</span></span><span class="level-end"><span class="level-item tag">8</span></span></a><ul><li><a class="level is-mobile" href="/categories/NXP/RT1050/%E9%87%8E%E7%81%AB/"><span class="level-start"><span class="level-item">野火</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/NXP/RT1060/"><span class="level-start"><span class="level-item">RT1060</span></span><span class="level-end"><span class="level-item tag">8</span></span></a><ul><li><a class="level is-mobile" href="/categories/NXP/RT1060/SAI/"><span class="level-start"><span class="level-item">SAI</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/NXP/RT1060/binary/"><span class="level-start"><span class="level-item">binary</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/NXP/RT1060/eDMA/"><span class="level-start"><span class="level-item">eDMA</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/NXP/RT600/"><span class="level-start"><span class="level-item">RT600</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/NXP/RT600/BootROM/"><span class="level-start"><span class="level-item">BootROM</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/NXP/ReferenceManual/"><span class="level-start"><span class="level-item">ReferenceManual</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/NXP/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%9F%BA%E7%A1%80/"><span class="level-start"><span class="level-item">嵌入式基础</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Plugins/"><span class="level-start"><span class="level-item">Plugins</span></span><span class="level-end"><span class="level-item tag">12</span></span></a><ul><li><a class="level is-mobile" href="/categories/Plugins/Analytics/"><span class="level-start"><span class="level-item">Analytics</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Plugins/Comment/"><span class="level-start"><span class="level-item">Comment</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Plugins/Donation/"><span class="level-start"><span class="level-item">Donation</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Plugins/Other/"><span class="level-start"><span class="level-item">Other</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Plugins/Search/"><span class="level-start"><span class="level-item">Search</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Plugins/Share/"><span class="level-start"><span class="level-item">Share</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Widgets/"><span class="level-start"><span class="level-item">Widgets</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%9F%BA%E7%A1%80/"><span class="level-start"><span class="level-item">嵌入式基础</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">开发工具</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/vim/"><span class="level-start"><span class="level-item">vim</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E6%80%BB%E7%BA%BF%E5%8D%8F%E8%AE%AE/"><span class="level-start"><span class="level-item">总线协议</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E6%80%BB%E7%BA%BF%E5%8D%8F%E8%AE%AE/UART/"><span class="level-start"><span class="level-item">UART</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E5%AD%97IC/"><span class="level-start"><span class="level-item">数字IC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%8B%B1%E8%AF%AD/"><span class="level-start"><span class="level-item">英语</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ARM/"><span class="tag">ARM</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BLE/"><span class="tag">BLE</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Boot/"><span class="tag">Boot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BootROM/"><span class="tag">BootROM</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DMA/"><span class="tag">DMA</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Demo/"><span class="tag">Demo</span><span class="tag">19</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FLASH/"><span class="tag">FLASH</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GPIO/"><span class="tag">GPIO</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GPIO%E4%B8%AD%E6%96%AD/"><span class="tag">GPIO中断</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Getting-Started/"><span class="tag">Getting Started</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/IC%E9%AA%8C%E8%AF%81/"><span class="tag">IC验证</span><span class="tag">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Icarus-User-Guide/"><span class="tag">Icarus User Guide</span><span class="tag">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Icarus%E7%94%A8%E6%88%B7%E6%8C%87%E5%8D%97/"><span class="tag">Icarus用户指南</span><span class="tag">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/KW38/"><span class="tag">KW38</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Leetcode/"><span class="tag">Leetcode</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MemoryMap/"><span class="tag">MemoryMap</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NLP/"><span class="tag">NLP</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NXP/"><span class="tag">NXP</span><span class="tag">36</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Numpy/"><span class="tag">Numpy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PDF/"><span class="tag">PDF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PyTorch/"><span class="tag">PyTorch</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RAM/"><span class="tag">RAM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ROM/"><span class="tag">ROM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RT1050/"><span class="tag">RT1050</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RT600/"><span class="tag">RT600</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ReferenceManual/"><span class="tag">ReferenceManual</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SAI/"><span class="tag">SAI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/STL/"><span class="tag">STL</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/System-Verilog/"><span class="tag">System Verilog</span><span class="tag">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TIMER/"><span class="tag">TIMER</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Thread/"><span class="tag">Thread</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/UART/"><span class="tag">UART</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/UVM/"><span class="tag">UVM</span><span class="tag">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ZigBee/"><span class="tag">ZigBee</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/eDMA/"><span class="tag">eDMA</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hardware/"><span class="tag">hardware</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/image/"><span class="tag">image</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pyTorch/"><span class="tag">pyTorch</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vector/"><span class="tag">vector</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vim/"><span class="tag">vim</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%B8%AD%E6%96%AD/"><span class="tag">中断</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/"><span class="tag">二分查找</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BB%A3%E7%A0%81%E9%9A%8F%E6%83%B3%E5%BD%95/"><span class="tag">代码随想录</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8E%9F%E7%90%86%E5%9B%BE/"><span class="tag">原理图</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2/"><span class="tag">数据探索</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"><span class="tag">数据结构</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E7%BB%84/"><span class="tag">数组</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%80%83%E7%A0%94%E8%8B%B1%E8%AF%AD100%E5%8F%A5/"><span class="tag">考研英语100句</span><span class="tag">20</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%8B%B1%E8%AF%AD/"><span class="tag">英语</span><span class="tag">20</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B/"><span class="tag">设计流程</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%93%BE%E8%A1%A8/"><span class="tag">链表</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="DustOfStars" height="28"></a><p class="is-size-7"><span>&copy; 2025 Gavin</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Discuss on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus/discussions"><i class="fas fa-comments"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>